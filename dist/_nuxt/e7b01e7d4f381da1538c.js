(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{365:function(n,t,e){var o=e(369);"string"==typeof o&&(o=[[n.i,o,""]]),o.locals&&(n.exports=o.locals);(0,e(20).default)("0abd31cc",o,!0,{})},368:function(n,t,e){"use strict";var o=e(365);e.n(o).a},369:function(n,t,e){(n.exports=e(19)(!1)).push([n.i,"#Chat .state[data-v-5a797c7b] {\n  border-radius: 100%;\n  width: 5px;\n  height: 5px;\n}\n#Chat .state-success[data-v-5a797c7b] {\n    background-color: #67c23a;\n}\n#Chat .state-close[data-v-5a797c7b] {\n    background-color: #F56C6C;\n}\n.chat-body[data-v-5a797c7b] {\n  padding: 0 10px;\n  padding-bottom: 56px;\n  z-index: 1;\n  overflow-x: hidden;\n  max-width: 100%;\n  position: relative;\n}\n.chat-body .time-box[data-v-5a797c7b] {\n    text-align: center;\n    width: 100%;\n    -webkit-transition: all 0.3s;\n    transition: all 0.3s;\n}\n.chat-body .time-box .time[data-v-5a797c7b] {\n      background-color: rgba(0, 0, 0, 0.4);\n      color: #fff;\n      line-height: 1;\n      border-radius: 3px;\n      display: inline-block;\n      font-size: 11px;\n      padding: 5px 10px;\n      margin-bottom: 10px;\n      margin-top: 10px;\n}\n.chat-input-box[data-v-5a797c7b] {\n  position: fixed;\n  bottom: 0;\n  right: 0;\n  left: 0;\n  background-color: #F7F7F7;\n  border-top: 1px solid #ddd;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  padding: 8px 10px;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  z-index: 1000;\n}\n.chat-input-box .img-icon[data-v-5a797c7b] {\n    color: #777;\n    font-size: 20px;\n}\n.chat-input-box input[data-v-5a797c7b] {\n    background-color: #fff;\n    line-height: 1;\n    padding: 10px;\n    -webkit-box-flex: 2;\n        -ms-flex-positive: 2;\n            flex-grow: 2;\n    margin-right: 8px;\n    border-radius: 5px;\n    outline: none;\n    border: none;\n}\n.chat-input-box .button[data-v-5a797c7b] {\n    -webkit-box-flex: 1;\n        -ms-flex-positive: 1;\n            flex-grow: 1;\n    padding: 10px;\n    border-radius: 5px;\n    text-align: center;\n    background-color: #38ac7f;\n    border: solid 1px #38ac7f;\n    color: #fff;\n    line-height: 1;\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n    -webkit-transition: all 0.3s;\n    transition: all 0.3s;\n    outline: none;\n}\n.chat-input-box .button[data-v-5a797c7b]:active {\n      opacity: 0.9;\n}\n.left-enter-active[data-v-5a797c7b],\n.left-leave-active[data-v-5a797c7b] {\n  opacity: 1;\n  -webkit-transform: translate3d(0, 0, 0);\n          transform: translate3d(0, 0, 0);\n}\n.left-leave-active[data-v-5a797c7b] {\n  position: absolute;\n}\n.left-enter[data-v-5a797c7b],\n.left-leave-to[data-v-5a797c7b] {\n  opacity: 0;\n  -webkit-transform: translate3d(-100%, 0, 0);\n          transform: translate3d(-100%, 0, 0);\n}\n.right-enter-active[data-v-5a797c7b],\n.right-leave-active[data-v-5a797c7b] {\n  opacity: 1;\n  -webkit-transform: translate3d(0, 0, 0);\n          transform: translate3d(0, 0, 0);\n}\n.right-leave-active[data-v-5a797c7b] {\n  position: absolute;\n}\n.right-enter[data-v-5a797c7b],\n.right-leave-to[data-v-5a797c7b] {\n  opacity: 0;\n  -webkit-transform: translate3d(100%, 0, 0);\n          transform: translate3d(100%, 0, 0);\n}\n.fide-enter-active[data-v-5a797c7b],\n.fide-leave-active[data-v-5a797c7b] {\n  opacity: 1;\n}\n.fide-leave-active[data-v-5a797c7b] {\n  -webkit-transition: all 0.3s;\n  transition: all 0.3s;\n}\n.fide-enter[data-v-5a797c7b],\n.fide-leave-to[data-v-5a797c7b] {\n  opacity: 0;\n}\n",""])},374:function(n,t,e){"use strict";e.r(t);var o=e(2),i=e.n(o),a=(e(132),e(133),e(9)),s=e.n(a);function r(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var c=e(77),d=e.n(c);function l(n,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),d()(n,o.key,o)}}var u=function(){function n(t){r(this,n),this.componentList={},this.callbacks={},this.host=t,this.ws=null}var t,e,o;return t=n,(e=[{key:"open",value:function(){var n=this;this.ws=new WebSocket(this.host),this.ws.onopen=function(t){return n.onopen(t)},this.ws.onclose=function(t){return n.onclose(t)},this.ws.onerror=function(t){return n.onerror(t)},this.ws.onmessage=function(t){return n.onmessage(t)}}},{key:"on",value:function(n,t){this.callbacks["on"+n]=t}},{key:"onopen",value:function(n){this.callbacks.onopen()}},{key:"onclose",value:function(){this.callbacks.onclose()}},{key:"onerror",value:function(){this.callbacks.onerror()}},{key:"onmessage",value:function(n){var t=JSON.parse(n.data);if(t.component){var e=t.component;this.componentList[e]?this.componentList[e].update(t.data):console.warn("未找到组件："+e)}else console.warn("接口并未返回组件名：",t);this.callbacks.onmessage&&this.callbacks.onmessage(t)}},{key:"send",value:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e={path:n,data:arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},component:t};this.ws.send(s()(e))}},{key:"addComponent",value:function(n,t){this.componentList[n]=t}}])&&l(t.prototype,e),o&&l(t,o),n}(),m=function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Function;r(this,n),this.update=t},h={name:"Chat",data:function(){return{ws:null,isOpen:!1,list:[],userName:this.$route.query.userName,roomId:this.$route.query.roomId,msg:"",scrollTimer:null,isMe:"left",endTime:0}},methods:{init:function(){var n=this,t=new u("ws://106.15.187.65:12138");t.on("open",this.onopen),t.on("close",this.onclose),t.on("error",this.onerror),t.on("message",this.onmessage),t.open(),t.addComponent("send",new m(function(t){n.info(t)})),t.addComponent("userExit",new m(function(t){n.info(t)})),this.ws=t},onRead:function(n,t){var e,o,a,s,r,c,d,l=this;(e=n.content,o=800,a=.5,c=new Image,d=new i.a(function(n){return c.onload=n}),c.src=e,d.then(function(){s=c.width,r=c.height;var n=document.createElement("canvas"),t=n.getContext("2d");return Math.max(s,r)>o?s>r?(n.width=o,n.height=o*r/s):(n.height=o,n.width=o*s/r):(n.width=s,n.height=r),t.clearRect(0,0,n.width,n.height),t.drawImage(c,0,0,n.width,n.height),n.toDataURL(e.split(",")[0].match(/:(.*?);/)[1],a)})).then(function(n){l.ws.send("Room/send","send",{roomId:l.roomId,userName:l.userName,msg:n,type:"msg",msgType:"image"})})},remove:function(n,t){var e=this;this.setIsMe(n.userName),this.$nextTick(function(){e.list.splice(t,1)})},send:function(){this.msg.length<=0?this.$toast("消息不能为空！"):(this.msg.length>255?(this.ws.send("Room/send","send",{type:"msg",msgType:"text",roomId:this.roomId,userName:this.userName,msg:this.msg.substr(0,255)}),this.ws.send("Room/send","send",{type:"msg",msgType:"text",roomId:this.roomId,userName:this.userName,msg:this.msg.substr(255,this.msg.length-255)})):this.ws.send("Room/send","send",{type:"msg",msgType:"text",roomId:this.roomId,userName:this.userName,msg:this.msg}),this.msg="",document.getElementById("msgInput").focus())},onopen:function(){this.isOpen=!0,this.ws.send("Room/send","send",{type:"msg",msgType:"text",roomId:this.roomId,userName:this.userName,msg:"进入房间"})},onclose:function(){this.isOpen=!1},onerror:function(){this.isOpen=!1},info:function(n){var t=this;n.id=Math.random(),n.uninxTime-this.endTime>=30&&(this.isMe="fide",this.list.push({type:"time",msg:n.time,id:Math.random()}),this.endTime=n.uninxTime),this.$nextTick(function(){t.setIsMe(n.userName),t.list.push(n)})},setIsMe:function(n){this.isMe=n==this.userName?"right":"left"},onmessage:function(n){this.updateView()},updateView:function(){var n=this;this.$nextTick(function(){clearInterval(n.scrollTimer),function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,o=arguments.length>1?arguments[1]:void 0;if(!o)return document.body.scrollTop=document.documentElement.scrollTop=e,e;var i=o/20,a=document.body.scrollTop+document.documentElement.scrollTop,s=(e-a)/i;n.scrollTimer=setInterval(function(){i>0?(i--,t(a+=s)):clearInterval(n.scrollTimer)},20)}(document.documentElement.scrollHeight,700)})}},computed:{},filters:{},created:function(){},beforeMount:function(){},mounted:function(){this.init(),this.$nextTick(function(){})},beforeUpdate:function(){},activated:function(){},deactivated:function(){},beforeDestroy:function(){},destroyed:function(){},errorCaptured:function(){},directives:{},watch:{},components:{}},p=(e(368),e(31)),f=Object(p.a)(h,function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("div",{attrs:{id:"Chat"}},[e("div",{staticClass:"chat-body clearfix"},[e("transition-group",{attrs:{name:n.isMe,tag:"div"}},[n._l(n.list,function(t,o){return["msg"==t.type?e("chat-card",{key:t.id,attrs:{info:t},on:{"on-remove":function(e){n.remove(t,o)}}}):n._e(),n._v(" "),"time"==t.type?e("div",{key:t.id,staticClass:"time-box",attrs:{info:t}},[e("div",{staticClass:"time"},[n._v("\n            "+n._s(t.msg)+"\n          ")])]):n._e()]})],2)],1),n._v(" "),e("div",{staticClass:"chat-input-box"},[e("van-uploader",{staticStyle:{"margin-right":"8px"},attrs:{"after-read":n.onRead}},[e("van-icon",{staticClass:"img-icon",attrs:{name:"photograph"}})],1),n._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:n.msg,expression:"msg"}],attrs:{type:"text",id:"msgInput"},domProps:{value:n.msg},on:{keydown:function(t){return"button"in t||!n._k(t.keyCode,"enter",13,t.key,"Enter")?n.send(t):null},input:function(t){t.target.composing||(n.msg=t.target.value)}}}),n._v(" "),e("button",{staticClass:"button",on:{click:n.send}},[n._v("发送")])],1)])},[],!1,null,"5a797c7b",null);f.options.__file="Chat.vue";t.default=f.exports}}]);